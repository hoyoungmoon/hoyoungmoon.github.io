동시성 문제


간병 서비스 매칭에 대한 로직 설명

중계업체 중에는 주말/야간 매칭 여부에 따라 주말, 야간에 매칭을 받지 않을 수 있다.
따라서 주말, 야간이 됨과 동시에 해당 매칭을 받지 않는 중계업체에 매칭을 대기하고 있는 서비스들을 다른 중계업체로 재배치한다.

하지만 재배치하는 과정 중 기존의 중계업체에서 매칭을 수락하는 문제가 발생할 수 있다.
또는 60분 마다 해당 중계업체에서 매칭이 되지 않을 경우 다른 중계업체로 재배치를 하는데 이때도 같은 문제가 발생할 가능성이 있다.

이를 해결할 방법은?


NodeJS를 이용학 있기 때문에 단일 스레드로 동작한다.
NodeJS의 구조 (이벤트루프, 등... )
근데 node-cron이 작동하고 있을 떄, 다른 매칭 수락같은걸 할 수 있나?
해본결과 node-cron으로 특정 데이터를 update하고 있는 중(재배치 중)에 다른 update가 가능하다 

=> 재배치가 되었는데 기존의 중계업체에서 수락할 경우 기존중계업체에서도 수락하고 재배치된 중계업체에서도 수락할 수 있다.

- 임시적으로는 중계업체에서 매번 수락할 때 마다 해당 매칭서비스가 대기중인 상태가 맞는지 한번 체크하는 로직을 추가하는 것이다.
하지만 이도 근본적인 해결책은 될 수 없다 (이유 설명 추가)

- 해당 데이터를 update하고 있을 때 (매칭을 재배치할 때) 다른 update가 되지 못하도록 해야한다(기존 중계업체가 수락하는 일)
